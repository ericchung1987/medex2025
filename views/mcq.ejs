<%- include('partials/header') %> <%- include('partials/navbar') %>
<%if(locals.userData.mcqCompleted === false){ %>
<link rel="stylesheet" href="/css/clock.css" />

<!-- Hidden stuff -->

<p style="display: none" id="jsonObject"><%= locals.mcq %></p>
<p style="display: none" id="userAnswerObjects">
    <%= JSON.stringify(locals.userData.mcqAnswer[0]) %>
</p>
<p style="display: none" id="time"><%= locals.userData.mcqStartTime %></p>

<div class="container">
    <div class="row">
        <div class="col-sm" style="text-align: right">
            <h1>MCQ Module</h1>
            <p>Please refresh the page if the timer does not load</p>
        </div>
        <div class="col-sm">
            <!-- Timer -->
            <div id="countdown">
                <div id="tiles" class="color-full"></div>
                <div class="countdown-label">Time Remaining</div>
            </div>
        </div>
    </div>
</div>
<hr />
<!-- Pagination -->
<div class="container">
    <nav>
        <ul class="pagination justify-content-center flex-wrap">
            <li class="page-item">
                <a class="page-link" href="?pages=1">1</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=2">2</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=3">3</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=4">4</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=5">5</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=6">6</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=7">7</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=8">8</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=9">9</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=10">10</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=11">11</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=12">12</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=13">13</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=14">14</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=15">15</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=16">16</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=17">17</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=18">18</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=19">19</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=20">20</a>
            </li>
        </ul>
    </nav>

    <nav>
        <ul class="pagination justify-content-center flex-wrap">
            <li class="page-item">
                <a class="page-link" href="?pages=21">21</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=22">22</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=23">23</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=24">24</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=25">25</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=26">26</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=27">27</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=28">28</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=29">29</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=30">30</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=31">31</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=32">32</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=33">33</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=34">34</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=35">35</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=36">36</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=37">37</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=38">38</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=39">39</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=40">40</a>
            </li>
        </ul>
    </nav>
    <nav>
        <ul class="pagination justify-content-center flex-wrap">
            <li class="page-item">
                <a class="page-link" href="?pages=41">41</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=42">42</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=43">43</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=44">44</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=45">45</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=46">46</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=47">47</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=48">48</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=49">49</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?pages=50">50</a>
            </li>
        </ul>
    </nav>
</div>

<div style="margin-bottom: 20px" class="text-center">
    <a class="btn btn-primary" href="/mcqsummary" role="button">Summary</a>
</div>

<hr />

<form action="/updatemcq" method="POST" id="question_form">
    <section>
        <input type="hidden" name="username" value="<%= userData.username %>" />
        <input type="hidden" id="question_field" name="question" />

        <div id="question_holder" class="container" style="padding: 0% 5%">
            <h3 id="question_number" class="question_no"></h3>
            <h6
                id="question_label"
                class="question_no"
                style="font-size: 30px"
            ></h6>
            <br />
        </div>
        <hr />
        <h6 style="text-align: center">Click to save your answer</h6>
        <div style="margin-bottom: 20px" class="text-center">
            <button id="submitbutton" class="btn btn-secondary">Save</button>
        </div>
    </section>
</form>

<!-- Generate question -->
<script>
    const jsonObject = $('#jsonObject').text();
    const mcq = JSON.parse(jsonObject);
    const userAnswerObjects = $('#userAnswerObjects').text();
    const userAnswer = JSON.parse(userAnswerObjects);

    // get the page first
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    var page = urlParams.get('pages');

    // also set the page number so it can be passed to post later
    $('#question_field').val(page);

    // Generate the question number
    $('#question_number').text('Question ' + page);

    // Generate the question
    let question_holder = $('#question_holder');

    let question = mcq[page];

    // label the main question label
    $('#question_label').text(question.question + ':');

    const answer_dict = { 0: 'A', 1: 'B', 2: 'C', 3: 'D', 4: 'E' };
    let answer_list = userAnswer[page];

    // Generate the options
    for (let i = 0; i < 5; i++) {
        let p = document.createElement('p');
        let label = document.createElement('label');
        label.setAttribute('for', answer_dict[i]);
        label.className = 'question_label';
        label.innerHTML = question[answer_dict[i]];
        let select = document.createElement('select');
        select.setAttribute('class', 'form-control form-control-sm');
        select.setAttribute('name', answer_dict[i]);
        let option1 = document.createElement('option');
        let option2 = document.createElement('option');
        let option3 = document.createElement('option');
        option1.innerHTML = '';
        option2.innerHTML = 'True';
        option3.innerHTML = 'False';
        option1.setAttribute('value', '');
        option2.setAttribute('value', 'T');
        option3.setAttribute('value', 'F');
        select.append(option1);
        select.append(option2);
        select.append(option3);
        p.append(label);
        p.append(select);
        question_holder.append(p);
        question_holder.append('<br>');

        if (answer_list[answer_dict[i]] == 'T') {
            select.value = 'T';
        } else if (answer_list[answer_dict[i]] == 'F') {
            select.value = 'F';
        } else {
            select.value = '';
        }
    }
</script>

<style>
    .question_label {
        font-size: 24px;
    }
</style>

<script src="/js/mcqquiz.js"></script>

<!-- Change the button text and color to indicate save -->
<script>
    $(document).ready(function () {
        const btn = document.getElementById('submitbutton');

        btn.addEventListener('click', () => {
            if (btn.innerHTML === 'Save') {
                btn.innerHTML = 'Answer Saved';
                btn.classList.toggle("btn-success");
                btn.classList.toggle("btn-primary");
            }
        });
    });
</script>

<%} %> <% if(locals.userData.mcqCompleted == true){ %>
<div class="container">
    <p>
        <%= userData.fullname %>, You have completed the MCQ module. Kindly
        navigate back to the <a href="/userpage">userpage</a> page.
    </p>
</div>
<%} %> <%- include('partials/footer') %>
